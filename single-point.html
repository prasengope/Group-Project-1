<!DOCTYPE html>
<html>
  <head>
    <style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 100%;
      }
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.js"></script>
    <script>

        var results;
        function getResults(zip) {
            // or
            // function getResults(lat, lng) {
            $.ajax({
                type: "GET",
                contentType: "application/json; charset=utf-8",
                // submit a get request to the restful service zipSearch or locSearch.
                url: "https://search.ams.usda.gov/farmersmarkets/v1/data.svc/zipSearch?zip=" + zip,
                // or
                // url: "http://search.ams.usda.gov/farmersmarkets/v1/data.svc/locSearch?lat=" + lat + "&lng=" + lng,
                dataType: 'jsonp',
                jsonpCallback: 'searchResultsHandler'
            });
        }
        //getResults(zip);
        getResults(27502);
        // iterate through the JSON result object.
        function searchResultsHandler(searchResults) {
            for (var key in searchResults) {
                alert(key);
                results = searchResults[key];
                for (var i = 0; i < results.length; i++) {
                    var result = results[i];
                    for (var key in result) {
                        //only do an alert on the first search result
                        if (i == 0) {
                            alert(result[key]);
                        }
                    }
                }
            }
        }

        var map;
        function initMap() {
            map = new google.maps.Map(document.getElementById('map'), {
            zoom: 2,
            center: new google.maps.LatLng(2.8,-187.3),
            mapTypeId: 'terrain'
            });

            var geocoder = new google.maps.Geocoder();

            
            geocodeAddress(geocoder, map);
        }

        function geocodeAddress(geocoder, resultsMap) {
            // var address = document.getElementById('address').value;
            var address ="Raleigh, NC"
            geocoder.geocode({'address': address}, function(results, status) {
                if (status === 'OK') {
                    resultsMap.setCenter(results[0].geometry.location);
                    var marker = new google.maps.Marker({
                    map: resultsMap,
                    position: results[0].geometry.location
                    });
                } else {
                    alert('Geocode was not successful for the following reason: ' + status);
                }
            });    

        // Loop through the results array and place a marker for each
        // set of coordinates.
        //   window.eqfeed_callback = function(results) {
        //     for (var i = 0; i < results.features.length; i++) {
        //       // actually where you pull in the coordinates both are in an object
        //       var coords = results.features[i].geometry.coordinates;
        //       console.log(results)
        //       // var latLng = new google.maps.LatLng(coords[1],coords[0]);
        //       var latLng = [37.5, 95.7];
        //       var marker = new google.maps.Marker({
        //         position: latLng,
        //         map: map
        //       });
        //     }
        //   }
        }
    </script>
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDFRyu277w4V5p1mjxGseqqo1yRXqBRbBw&callback=initMap">
    </script>
  </body>
</html>

